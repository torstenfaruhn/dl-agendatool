<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8" />
    <title>DL Agendatool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<header class="hero">
    <!-- Hero-achtergrond -->
    <img
        src="{{ url_for('static', filename='UitTipsLimburg.png') }}"
        alt="UitTipsLimburg achtergrond"
        class="hero__img"
    />

    <!-- Donkere overlay zodat tekst leesbaar blijft -->
    <div class="hero__overlay"></div>

    <!-- Logo op dezelfde plek als in het voorbeeld -->
    <img
        src="{{ url_for('static', filename='logo.png') }}"
        alt="De Limburger"
        class="hero__logo"
    />

    <!-- Titel + subtitel -->
    <div class="hero__content">
        <h1>Maak snel je agenda-export</h1>
        <p>Upload je XML-agenda en kopieer of download direct de geconverteerde tekst.</p>
    </div>
</header>

<main class="container">
    <section class="card">
        <h2>Agendatool</h2>
        <p class="card__intro">
            Upload het XML-bestand uit je planningssysteem. Klik daarna op
            <strong>Maak agenda-export (.txt)</strong>. Je krijgt een tekstbestand dat je
            direct kunt gebruiken voor UitTipsLimburg.nl.
        </p>

        {% if error %}
        <p class="error">{{ error }}</p>
        {% endif %}

        <form method="post" enctype="multipart/form-data">
            <!-- Eerste rij: bestand kiezen + actieknop -->
            <div class="button-row">
                <label class="file" id="file-label">
                    <span class="file__label" id="file-label-text">Bestand kiezen</span>
                    <input
                        type="file"
                        id="xml_file"
                        name="xml_file"
                        accept=".xml"
                    />
                </label>

                <button type="submit" class="btn btn-primary">
                    Maak agenda-export (.txt)
                </button>
            </div>

            {% if output_text %}
            <!-- Tweede rij: download + kopieer -->
            <div class="button-row button-row--secondary">
                <button type="button" class="btn btn-secondary" id="download-btn">
                    Download resultaat (.txt)
                </button>
                <button type="button" class="btn btn-secondary" id="copy-btn">
                    Kopieer direct de code
                </button>
            </div>

            <!-- Verborgen tekstvak voor de gegenereerde code (nodig voor kopiëren/downloaden) -->
            <textarea id="result-text" class="visually-hidden" readonly>{{ output_text }}</textarea>
            {% endif %}
        </form>
    </section>
</main>

<footer class="footer">
    &copy; DL/MHNL 2025
</footer>

<script>
    // Bestandsknop: labeltekst + styling aanpassen
    const fileInput = document.getElementById('xml_file');
    const fileLabel = document.getElementById('file-label');
    const fileLabelText = document.getElementById('file-label-text');

    if (fileInput && fileLabel && fileLabelText) {
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length) {
                const name = fileInput.files[0].name;
                fileLabel.classList.add('file--selected');
                fileLabelText.textContent = name;
            } else {
                fileLabel.classList.remove('file--selected');
                fileLabelText.textContent = 'Bestand kiezen';
            }
        });
    }

    // Helperfunctie om een knop tijdelijk groen te maken bij succes
    function flashSuccess(button, successText) {
        const originalText = button.textContent;
        button.classList.add('btn-success');
        button.textContent = successText;

        setTimeout(() => {
            button.classList.remove('btn-success');
            button.textContent = originalText;
        }, 1500);
    }

    const copyBtn = document.getElementById('copy-btn');
    const downloadBtn = document.getElementById('download-btn');
    const resultText = document.getElementById('result-text');

    // Kopieer resultaat naar klembord
    if (copyBtn && resultText) {
        copyBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(resultText.value);
                flashSuccess(copyBtn, 'Gekopieerd!');
            } catch (e) {
                alert('Kopiëren is niet gelukt. Kopieer de tekst handmatig.');
            }
        });
    }

    // Download resultaat als .txt
    if (downloadBtn && resultText) {
        downloadBtn.addEventListener('click', () => {
            const blob = new Blob([resultText.value], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'agenda_export.txt';
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);

            flashSuccess(downloadBtn, 'Gedownload!');
        });
    }
</script>

</body>
</html>
