<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8" />
    <title>DL Agendatool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<header class="hero">
    <!-- Hero-achtergrond -->
    <img
        src="{{ url_for('static', filename='UitTipsLimburg.png') }}"
        alt="UitTipsLimburg achtergrond"
        class="hero__img"
    />

    <!-- Donkere overlay zodat tekst leesbaar blijft -->
    <div class="hero__overlay"></div>

    <!-- Logo op dezelfde plek als in het voorbeeld -->
    <img
        src="{{ url_for('static', filename='logo.png') }}"
        alt="De Limburger"
        class="hero__logo"
    />

    <!-- Titel + subtitel -->
    <div class="hero__content">
        <h1>Maak snel je agenda-export</h1>
        <p>Upload je XML-agenda en kopieer of download direct de geconverteerde tekst.</p>
    </div>
</header>

<main class="container">
    <section class="card">
        <h2>Agendatool</h2>
        <p class="card__intro">
            Upload het XML-bestand uit je planningssysteem. Klik daarna op
            <strong>Maak agenda-export (.txt)</strong>. Je krijgt een tekstbestand dat je
            direct kunt gebruiken voor UitTipsLimburg.nl.
        </p>

        {% if error %}
        <p class="error">{{ error }}</p>
        {% endif %}

        <form method="post" enctype="multipart/form-data">
            <!-- Eerste rij: bestand kiezen + actieknop -->
            <div class="button-row">
                <label class="file btn-equal" id="file-label">
                    <span class="file__label" id="file-label-text">Bestand kiezen</span>
                    <input
                        type="file"
                        id="xml_file"
                        name="xml_file"
                        accept=".xml"
                    />
                </label>

                <button type="submit"
                        class="btn btn-primary btn-equal{% if output_text %} btn-success{% endif %}"
                        id="export-btn">
                    Maak agenda-export (.txt)
                </button>
            </div>

            {% if output_text %}
            <!-- Tweede rij: download + kopieer -->
            <div class="button-row button-row--secondary">
                <button type="button" class="btn btn-secondary btn-equal" id="download-btn">
                    Download resultaat (.txt)
                </button>
                <button type="button" class="btn btn-secondary btn-equal" id="copy-btn">
                    Kopieer direct de code
                </button>
            </div>

            <!-- Verborgen tekstvak voor de gegenereerde code (nodig voor kopiëren/downloaden) -->
            <textarea id="result-text" class="visually-hidden" readonly>{{ output_text }}</textarea>
            {% endif %}
        </form>
    </section>
</main>

<footer class="footer">
    &copy; DL/MHNL 2025
</footer>

<script>
    const fileInput = document.getElementById('xml_file');
    const fileLabel = document.getElementById('file-label');
    const fileLabelText = document.getElementById('file-label-text');

    const exportBtn = document.getElementById('export-btn');
    const copyBtn = document.getElementById('copy-btn');
    const downloadBtn = document.getElementById('download-btn');
    const resultText = document.getElementById('result-text');

    const successClass = 'btn-success';

    // Oorspronkelijke teksten opslaan
    const originalTexts = {
        export: "Maak agenda-export (.txt)",
        download: "Download resultaat (.txt)",
        copy: "Kopieer direct de code"
    };

    // Succes teksten
    const successTexts = {
        export: "Export geslaagd!",
        download: "Resultaat gedownload!",
        copy: "Code gekopieerd!"
    };

    function clearAllSuccess() {
        // Reset knoppen naar originele tekst en style
        if (exportBtn) {
            exportBtn.classList.remove(successClass);
            exportBtn.textContent = originalTexts.export;
        }
        if (downloadBtn) {
            downloadBtn.classList.remove(successClass);
            downloadBtn.textContent = originalTexts.download;
        }
        if (copyBtn) {
            copyBtn.classList.remove(successClass);
            copyBtn.textContent = originalTexts.copy;
        }
    }

    function markSuccess(button, successText) {
        if (!button) return;
        button.classList.add(successClass);
        button.textContent = successText;
    }

    // Nieuw XML-bestand gekozen → reset ALLES en maak de file-knop groen
    if (fileInput && fileLabel && fileLabelText) {
        fileInput.addEventListener('change', () => {
            clearAllSuccess();

            if (fileInput.files.length) {
                const name = fileInput.files[0].name;
                fileLabel.classList.add('file--selected');
                fileLabelText.textContent = name;

                // File label wordt groen
                fileLabel.classList.add(successClass);
            } else {
                fileLabel.classList.remove('file--selected');
                fileLabel.classList.remove(successClass);
                fileLabelText.textContent = 'Bestand kiezen';
            }
        });
    }

    // Export: file-label direct terug wit maken
    if (exportBtn && fileLabel) {
        exportBtn.addEventListener('click', () => {
            fileLabel.classList.remove(successClass);
            markSuccess(exportBtn, successTexts.export);
        });
    }

    // Download
    if (downloadBtn && resultText) {
        downloadBtn.addEventListener('click', () => {
            const blob = new Blob([resultText.value], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'agenda_export.txt';
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);

            markSuccess(downloadBtn, successTexts.download);
        });
    }

    // Kopieer
    if (copyBtn && resultText) {
        copyBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(resultText.value);
                markSuccess(copyBtn, successTexts.copy);
            } catch {
                alert('Kopiëren is niet gelukt. Probeer handmatig te kopiëren.');
            }
        });
    }
</script>


</body>
</html>
