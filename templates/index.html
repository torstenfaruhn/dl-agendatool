<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8" />
    <title>DL Agendatool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<header class="hero">
    <!-- Achtergrondfoto zoals in het voorbeeld -->
    <img
        src="https://images.pexels.com/photos/399187/pexels-photo-399187.jpeg?auto=compress&cs=tinysrgb&w=1600"
        alt="Voetbal op grasveld"
        class="hero__img"
    />

    <!-- De Limburger-logo -->
    <img
        src="{{ url_for('static', filename='logo.png') }}"
        alt="De Limburger"
        class="hero__logo"
    />

    <div class="hero__overlay">
        <h1>Maak snel je agenda-export</h1>
        <p>Upload een XML-agenda en kopieer of download direct de geconverteerde tekst.</p>
    </div>
</header>

<main class="container">
    <section class="card">
        <div class="card__head">
            <h3>Agendatool</h3>
            <p>
                Upload het XML-bestand uit je planningssysteem. Klik daarna op
                <strong>Maak agenda-export (.txt)</strong>. Je krijgt de tekst die je direct
                kunt kopiëren of downloaden.
            </p>
        </div>

        {% if error %}
        <p class="error">{{ error }}</p>
        {% endif %}

        <form method="post" enctype="multipart/form-data">
            <!-- Bovenste rij: bestand kiezen + actieknop -->
            <div class="upload">
                <label class="file" id="file-label">
                    <span class="file__label" id="file-label-text">Bestand kiezen</span>
                    <input
                        type="file"
                        id="xml_file"
                        name="xml_file"
                        accept=".xml"
                    />
                </label>

                <button type="submit" class="btn">
                    Maak agenda-export (.txt)
                </button>
            </div>

            {% if output_text %}
            <!-- Tweede rij knoppen onder de form, in dezelfde stijl als voorbeeld -->
            <div class="actions actions--bottom">
                <!-- Eventueel toekomstige knop 'Download leeg sjabloon' zou hier ook passen -->
                <button type="button" class="btn btn-outline" id="download-btn">
                    Download resultaat (.txt)
                </button>
                <button type="button" class="btn btn-outline" id="copy-btn">
                    Kopieer direct de code
                </button>
            </div>
            {% endif %}
        </form>

        {% if output_text %}
        <section class="result">
            <h4 class="visually-hidden">Resultaat</h4>
            <textarea id="result-text" readonly>{{ output_text }}</textarea>
        </section>
        {% endif %}
    </section>
</main>

<footer>
    &copy; DL/MHNL 2025
</footer>

<script>
    // Bestand kiezen -> knop groen + bestandsnaam tonen
    const fileInput = document.getElementById('xml_file');
    const fileLabel = document.getElementById('file-label');
    const fileLabelText = document.getElementById('file-label-text');

    if (fileInput && fileLabel && fileLabelText) {
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length) {
                const name = fileInput.files[0].name;
                fileLabel.classList.add('selected');
                fileLabelText.textContent = name;
            } else {
                fileLabel.classList.remove('selected');
                fileLabelText.textContent = 'Bestand kiezen';
            }
        });
    }

    // Kopieer resultaat
    const copyBtn = document.getElementById('copy-btn');
    const resultText = document.getElementById('result-text');

    if (copyBtn && resultText) {
        copyBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(resultText.value);
                copyBtn.textContent = 'Gekopieerd!';
                setTimeout(() => {
                    copyBtn.textContent = 'Kopieer direct de code';
                }, 1500);
            } catch (e) {
                alert('Kopiëren is niet gelukt. Kopieer de tekst handmatig.');
            }
        });
    }

    // Download resultaat
    const downloadBtn = document.getElementById('download-btn');

    if (downloadBtn && resultText) {
        downloadBtn.addEventListener('click', () => {
            const blob = new Blob([resultText.value], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'agenda_export.txt';
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
        });
    }
</script>

</body>
</html>
